{
  "name": "Nfebrasil",
  "tagline": "API de Nota Fiscal",
  "body": "NFeBrasil API\r\n---\r\n\r\nA princípio, essa API tem um único objetivo que é recuperar dados de uma nota fiscal referente a chave de acesso desejada.\r\n\r\nAs informações são parseadas do site da [Fazenda](http://www.nfe.fazenda.gov.br/portal/consulta.aspx?tipoConsulta=completa).\r\n\r\n# Documentação\r\n\r\n### Recuperar um captcha\r\n\r\nAbre uma sessão com o site da receita retornando um captcha para ser usado na recuperação dos dados na NFe.\r\n\r\n| URL   | Verbo | Query String | Dados |\r\n| ----  | ----- | ------------ | ----- |  \r\n| /api/ | GET   | -            | - \t   |\r\n\r\n* **Sucesso**\r\n\r\n  **Código:** 200 OK <br />\r\n  **Resposta:** `{ \"captcha_src\" : \"data:image/png;base64,iVBORw0KGgo...\" }`\r\n \r\n* **Erro**\r\n\r\n  **Código:** 401 UNAUTHORIZED <br />\r\n  **Resposta:** `{ \"detail\" : \"Authentication credentials were not provided.\" }`\r\n\r\n* **Exemplo:**\r\n\r\n  ```\r\n  curl -H \"Authorization: Bearer <access_token>\" https://nfebrasil.herokuapp.com/api/\r\n  ```\r\n\r\n### Recuperar dados da NF\r\n\r\nRecupera dados de uma nota fiscal eletrônica que esteja acessível através do site da Fazenda.\r\n\r\n| URL   | Verbo | Query String | Dados \t\t  | Descrição \t\t\t\t|\r\n| ----  | ----- | ------------ | ------------ | ----------------------- |  \r\n| /api/ | POST  | -            | nfeAccessKey | Chave de acesso         |\r\n|       |       |              | nfeCaptcha\t  | Texto plano do captcha  |\r\n\r\n* **Sucesso**\r\n\r\n  **Código:** 200 OK <br />\r\n  **Resposta:** \r\n  ```json\r\n\t{\"nfe\": {\r\n\t\t    \"dados\": {\r\n\t\t        \"serie\": number,\r\n\t\t        \"numero\": string,\r\n\t\t        \"total\": number\r\n\t\t    },\r\n\t\t    \"emitente\": {\r\n\t\t        \"cnpj\": string,\r\n\t\t        \"razao_social\": string,\r\n\t\t        \"nome_fantasia\": string,\r\n\t\t        \"endereco\": string,\r\n\t\t        \"uf\": string,\r\n\t\t        \"cidade\": string,\r\n\t\t    },\r\n\t\t    \"items\": [{\r\n\t\t    \t\"indice\": number,\r\n\t            \"descricao\": string,\r\n\t            \"quantidade\": number,\r\n\t            \"unidade\": string,\r\n\t            \"valor\": number\r\n\t\t    }]\r\n\t\t}\r\n\t}\r\n\t```\r\n \r\n* **Erro**\r\n\r\n  **Código:** 401 UNAUTHORIZED <br />\r\n  **Resposta:** `{ \"detail\" : \"Authentication credentials were not provided.\" }`\r\n\r\n* **Exemplo:**\r\n\r\n  ```\r\n  curl -H \"Authorization: Bearer nuT0noX8eJgQQXc0o0mWL6uMoCFk88\" --data \"nfeAccessKey=<chave_de_acesso>&nfeCaptcha=<captcha_lowercase>\" https://nfebrasil.herokuapp.com/api/\r\n  ```\r\n\r\n# Consumindo a API\r\n\r\n### 1. Autenticação\r\nFaço o cadastro da aplicação que irá consumir a API em (https://nfebrasil.herokuapp.com/o/applications).\r\n\r\nEx:\r\nClient type: `Confidential`  \r\nGrant type: `Client credentials`\r\n\r\n**Importante:** É recomendado o uso de fluxos OAuth não baseados em redirecionamento. Por isso não é necessário se preocupar com o campo `redirect uris`.\r\n\r\n### 1.1 Obtenha o Access Token\r\n\r\nClient credential:\r\n```\r\ncurl --user <client_id>:<client_secret> --data \"grant_type=client_credentials\" https://nfebrasil.herokuapp.com/o/token/\r\n```\r\n\r\n```json\r\n{\r\n\t\"access_token\": \"nuT0noX8eJgQQXc0o0mWL6uMoCFk88\", \r\n\t\"scope\": \"read\", \r\n\t\"expires_in\": 36000, \r\n\t\"token_type\": \"Bearer\"\r\n}\r\n```\r\n\r\n### 2. Captcha\r\nO site da fazenda solicita um captcha. Atualmente a forma que a API lida com isso é repassando o captcha para ser resolvido no lado do usuário:\r\n\r\nFaça a primeira requisição para (https://nfebrasil.herokuapp.com/api/) com o Access Token da requisição anterior.\r\n\r\n```\r\ncurl -H \"Authorization: Bearer <access_token>\" https://nfebrasil.herokuapp.com/api/\r\n```\r\n\r\nReceberá a seguinte resposta:\r\n\r\n```json\r\n{\r\n\t\"captcha_src\": \"data:image/png;base64,iVBORw0K...\"\r\n}\r\n```\r\nO valor de `captcha_src` deve ser entrada para a formação de uma imagem, por exemplo:\r\n\r\n```html\r\n<img src=\"<captcha_src>\" />\r\n```\r\n\r\n### 3. Informações da NFe\r\n\r\nCom o mesmo access_token usado para fazer a requisição do captcha, faça um nova requisição passando o captcha decifrado e a chave de acesso:\r\n\r\n```\r\ncurl -H \"Authorization: Bearer nuT0noX8eJgQQXc0o0mWL6uMoCFk88\" --data \"nfeAccessKey=<chave_de_acesso>&nfeCaptcha=<captcha_lowercase>\" https://nfebrasil.herokuapp.com/api/\r\n```\r\n\r\n# Considerações\r\n\r\n- A versão está em desenvolvimento. Sugira o que quiser.\r\n- O slash `/` no final das URLs são importantes.\r\n- A API não é e provavelmente não será estável. O parseamento usa XPath e por isso qualquer alteração na página de exibição da NF no site da Fazenda irá quebrar a resposta.\r\n- O código estará no GitHub em breve.\r\n- Por pelo menos 30 minutos diário o serviço ficará offline pois está hospedado na conta free do Heroku.\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}